<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BBQ Rive Animation</title>
    <script src="https://unpkg.com/@rive-app/webgl"></script>
    <style>
      body {
        margin: 0;
        background: #111;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }
      canvas {
        width: 600px;
        height: 600px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <canvas id="riveCanvas" width="600" height="600"></canvas>
    
    <!-- Hidden RSVP anchor -->
    <a id="rsvpLink" href="https://docs.google.com/forms/d/e/1FAIpQLSeymNP0_ALvCorlc1mI8A6uw8KL91-uXZdShzrSTDEUbpD2Kg/viewform" target="_blank" rel="noopener noreferrer" style="display: none;"></a>

    <script>
      const riveInstance = new rive.Rive({
        src: '/2025_bbq.riv',
        canvas: document.getElementById('riveCanvas'),
        autoplay: true,
        stateMachines: ['State Machine 1'],
        onLoad: () => {
          const inputs = riveInstance.stateMachineInputs('State Machine 1');

          const cursorX = inputs.find(i => i.name === 'Text RED X');
          const cursorY = inputs.find(i => i.name === 'Text RED Y');
          const crazy = inputs.find(i => i.name === 'Crazy');
          
          if (!cursorX || !cursorY || !crazy) {
            console.warn('Missing one or more state inputs.');
            return;
          }

          document.addEventListener('mousemove', (e) => {
            const bounds = riveInstance.canvas.getBoundingClientRect();
            const x = ((e.clientX - bounds.left) / bounds.width) * 100;
            const y = ((e.clientY - bounds.top) / bounds.height) * 100;
            cursorX.value = x;
            cursorY.value = y;
          });

          riveInstance.canvas.addEventListener('click', (e) => {
            const bounds = riveInstance.canvas.getBoundingClientRect();
            const x = e.clientX - bounds.left;
            const y = e.clientY - bounds.top;

            const maskArea = { x: 220, y: 140, width: 160, height: 160 };
            const isInMask =
              x >= maskArea.x && x <= maskArea.x + maskArea.width &&
              y >= maskArea.y && y <= maskArea.y + maskArea.height;

            if (isInMask) {
              crazy.value = crazy.value === 0 ? 100 : 0;
            }

            const rsvpArea = { x: 230, y: 520, width: 140, height: 40 };
            const isRSVPClick =
              x >= rsvpArea.x && x <= rsvpArea.x + rsvpArea.width &&
              y >= rsvpArea.y && y <= rsvpArea.y + rsvpArea.height;

            if (isRSVPClick) {
              document.getElementById('rsvpLink').click(); // ðŸ’¥ The fix
            }
          });

          riveInstance.canvas.addEventListener('mousemove', (e) => {
            const bounds = riveInstance.canvas.getBoundingClientRect();
            const x = e.clientX - bounds.left;
            const y = e.clientY - bounds.top;

            const rsvpArea = { x: 230, y: 520, width: 140, height: 40 };
            const isHoverRSVP =
              x >= rsvpArea.x && x <= rsvpArea.x + rsvpArea.width &&
              y >= rsvpArea.y && y <= rsvpArea.y + rsvpArea.height;

            if (isHoverRSVP && crazy.value > 0) {
              crazy.value = 0;
            }
          });
        }
      });
    </script>
  </body>
</html>